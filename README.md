# Live2D Assistant

## é¡¹ç›®ç®€ä»‹

**Live2D Assistant** æ˜¯ä¸€ä¸ªé›†æˆäº† Live2D è™šæ‹Ÿå½¢è±¡ã€AI æ™ºèƒ½å¯¹è¯ã€æ’ä»¶åŒ–å·¥å…·è°ƒç”¨èƒ½åŠ›çš„å¤šç«¯ï¼ˆWeb/Electron æ¡Œé¢ï¼‰åŠ©æ‰‹å¹³å°ã€‚é¡¹ç›®æ”¯æŒè‡ªå®šä¹‰ Live2D æ¨¡å‹ã€AI å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ¥å…¥ã€TTS è¯­éŸ³åˆæˆã€MCP å¤šå·¥å…·æœåŠ¡å™¨æ‰©å±•ï¼Œé€‚åˆäºŒæ¬¡å…ƒäº’åŠ¨ã€AI åŠ©æ‰‹ã€æ™ºèƒ½æ¡Œæ­ç­‰å¤šç§åœºæ™¯ã€‚

## ä¸»è¦ç‰¹æ€§
- ğŸ¨ **Live2D è™šæ‹Ÿå½¢è±¡**ï¼šæ”¯æŒè‡ªå®šä¹‰æ¨¡å‹ã€èƒŒæ™¯ã€ç¼©æ”¾ä¸ä½ç½®è°ƒæ•´ã€‚
- ğŸ¤– **AI æ™ºèƒ½å¯¹è¯**ï¼šé€šè¿‡OpenAié€‚é…æ¥å£é›†æˆå¤šç§ LLMï¼ˆå¦‚ Qwenã€Ollamaã€æœ¬åœ°/äº‘ç«¯ OpenAI ç­‰ï¼‰ï¼Œæ”¯æŒä¸Šä¸‹æ–‡å¤šè½®å¯¹è¯ã€‚
- ğŸ” **Web æœç´¢ (WIP)**ï¼šæ”¯æŒé€šè¿‡ Web æœç´¢è·å–ä¿¡æ¯ã€‚
- ğŸ—£ï¸ **TTS è¯­éŸ³åˆæˆ (WIP)**ï¼šå¯é€‰é›†æˆè¯­éŸ³æ’­æŠ¥ï¼Œæ”¯æŒ CosyVoiceã€ChatTTS ç­‰ã€‚
- ğŸ§© **MCP æ’ä»¶æ‰©å±•**ï¼šæ”¯æŒé€šè¿‡ MCP åè®®æ‰©å±•éŸ³ä¹æ’­æ”¾ã€æœç´¢ã€RAG æ£€ç´¢ç­‰å·¥å…·ã€‚
- ğŸ–¥ï¸ **å¤šç«¯æ”¯æŒ**ï¼šWeb ç«¯ï¼ˆVite+Vue3ï¼‰ã€æ¡Œé¢ç«¯ï¼ˆElectronï¼‰ä¸€é”®åˆ‡æ¢ã€‚
- ğŸ› ï¸ **ä¸°å¯Œè®¾ç½®**ï¼šæ”¯æŒåŠ©æ‰‹åç§°ã€ç³»ç»Ÿæç¤ºè¯ã€æ¨¡å‹å‚æ•°ã€èƒŒæ™¯ç­‰å¤šé¡¹è‡ªå®šä¹‰ã€‚

## ç›®å½•ç»“æ„
```
â”œâ”€â”€ live2d-assistant-fe/        # å‰ç«¯é¡¹ç›®ï¼ˆVue3 + Viteï¼‰
â”‚   â”œâ”€â”€ src/                    # å‰ç«¯æºç 
â”‚   â”‚   â”œâ”€â”€ components/         # Vue ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ router/             # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ types/              # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”‚   â”œâ”€â”€ package.json            # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â””â”€â”€ vite.config.ts          # Vite æ„å»ºé…ç½®
â”œâ”€â”€ live2d-assistant-server/    # åç«¯é¡¹ç›®ï¼ˆPython FastAPIï¼‰
â”‚   â”œâ”€â”€ live2d_server/          # ä¸»è¦æœåŠ¡ä»£ç 
â”‚   â”‚   â”œâ”€â”€ server.py           # FastAPI æœåŠ¡å…¥å£
â”‚   â”‚   â”œâ”€â”€ client.py           # MCP å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ router.py           # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ rag.py              # RAG æ£€ç´¢åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ agent/              # AI ä»£ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ search/             # æœç´¢åŠŸèƒ½
â”‚   â”‚   â””â”€â”€ tools/              # å·¥å…·é›†åˆ
â”‚   â”œâ”€â”€ main.py                 # åç«¯å¯åŠ¨å…¥å£
â”‚   â”œâ”€â”€ pyproject.toml          # Python é¡¹ç›®é…ç½®
â”‚   â””â”€â”€ utils/                  # å·¥å…·æ¨¡å—
â”œâ”€â”€ electron-live2d/            # Electron æ¡Œé¢ç«¯
â”‚   â”œâ”€â”€ src/                    # Electron ä¸»è¿›ç¨‹ä»£ç 
â”‚   â””â”€â”€ ...
â”œâ”€â”€ mcp_servers/                # MCP æœåŠ¡å™¨æ’ä»¶
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Makefile                    # æ„å»ºè„šæœ¬
â””â”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
```

## å®‰è£…ä¸è¿è¡Œ

### 1. å‰ç«¯ Web ç‰ˆ
```bash
cd live2d-assistant-fe
# å®‰è£…ä¾èµ–
npm install
# å¯åŠ¨å¼€å‘ç¯å¢ƒ
npm run dev
# æ„å»ºç”Ÿäº§åŒ…
npm run build
```

### 2. æ¡Œé¢ Electron ç‰ˆ
```bash
cd electron-live2d
npm install
# å¯åŠ¨ Electron æ¡Œé¢ç«¯
npm run start
# æ‰“åŒ…æ¡Œé¢åº”ç”¨
npm run package
```

### 3. åç«¯æœåŠ¡ï¼ˆPython FastAPIï¼‰
```bash
cd live2d-assistant-server
# æ¨èä½¿ç”¨uv
uv venv
uv sync
fastapi run main.py --host 0.0.0.0 --port 8000 --static_path ../live2d-assistant-fe/dist
```

## é…ç½®è¯´æ˜
- **Live2D æ¨¡å‹ä¸èƒŒæ™¯**ï¼šå¯åœ¨å‰ç«¯è®¾ç½®é¡µé¢è‡ªå®šä¹‰æ¨¡å‹è·¯å¾„ã€ç¼©æ”¾ã€åç§»ã€èƒŒæ™¯å›¾ç‰‡ã€‚
- **AI åŠ©æ‰‹å‚æ•°**ï¼šæ”¯æŒè‡ªå®šä¹‰åŠ©æ‰‹åç§°ã€ç³»ç»Ÿæç¤ºè¯ã€æ¨¡å‹ç±»å‹ã€API Keyã€Base URL ç­‰ã€‚
- **MCP å·¥å…·æœåŠ¡å™¨**ï¼šå¯åœ¨ config.json ä¸­æ·»åŠ è‡ªå®šä¹‰å·¥å…·æœåŠ¡å™¨ï¼ˆå¦‚éŸ³ä¹æ’­æ”¾å™¨ã€RAG æ£€ç´¢ç­‰ï¼‰ã€‚

## æ‰©å±•
- é¡¹ç›®æ”¯æŒé€šè¿‡ MCP åè®®æ‰©å±•å·¥å…·èƒ½åŠ›ï¼Œä½ å¯ä»¥é€šè¿‡ MCP åè®®æ‰©å±•æ›´å¤šå·¥å…·ã€‚

mcpçš„ç¤ºä¾‹é…ç½®å¦‚ä¸‹
```json
[
  {
    "name": "music_player",
    "transport": "sse",
    "url": "http://127.0.0.1:8000/erp-mcp/sse"
  }
]
```
## ä¾èµ–è¯´æ˜
- å‰ç«¯ï¼šVue3ã€Viteã€Ant Design Vueã€Element Plusã€pixi.jsã€pixi-live2d-display ç­‰
- åç«¯ï¼šFastAPIã€Uvicornã€Pydanticã€Ollamaã€OpenAIã€LangChainã€Torchã€Seleniumã€BeautifulSoup4 ç­‰
- æ¡Œé¢ç«¯ï¼šElectronã€Expressã€fs-extraã€node-fetch ç­‰

### Agent ç³»ç»Ÿ

é¡¹ç›®é‡‡ç”¨åŸºäº **LangGraph** çš„å¤šä»£ç†ï¼ˆMulti-Agentï¼‰æ¶æ„ï¼Œæ”¯æŒåŠ¨æ€åˆ›å»ºå’Œç®¡ç†å¤šä¸ªä¸“ä¸šåŒ– AI åŠ©æ‰‹ï¼Œé€šè¿‡åä½œå®Œæˆå¤æ‚ä»»åŠ¡ã€‚

#### æ ¸å¿ƒç‰¹æ€§

- ğŸ¯ **å¤šä»£ç†åä½œ**ï¼šæ”¯æŒå¤šä¸ªä¸“ä¸šåŒ– Agent ååŒå·¥ä½œ
- ğŸ§  **æ™ºèƒ½å†³ç­–**ï¼šDecision Maker è´Ÿè´£ä»»åŠ¡è§„åˆ’å’Œä»£ç†è°ƒåº¦
- ğŸ”§ **å·¥å…·é›†æˆ**ï¼šæ¯ä¸ª Agent å¯é…ç½®ä¸“å±å·¥å…·é›†ï¼ˆMCPã€æœ¬åœ°æ–‡ä»¶ã€Python ä»£ç ç­‰ï¼‰
- âš¡ **å¼‚æ­¥æ‰§è¡Œ**ï¼šåŸºäº LangGraph çš„å¼‚æ­¥çŠ¶æ€å›¾æ‰§è¡Œ
- ğŸ”„ **çŠ¶æ€ç®¡ç†**ï¼šæ”¯æŒä¸­æ–­ã€æ¢å¤å’ŒçŠ¶æ€æŒä¹…åŒ–
- ğŸ“‹ **åŠ¨æ€é…ç½®**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€å®šä¹‰ Agent èƒ½åŠ›

#### Agent é…ç½®

æ¯ä¸ª Agent é€šè¿‡ `AgentConfig` è¿›è¡Œé…ç½®ï¼š

```python
{
  "name": "research_assistant",           # Agent åç§°
  "description": "ä¸“ä¸šçš„ç ”ç©¶åŠ©æ‰‹ï¼Œæ“…é•¿ä¿¡æ¯æ”¶é›†å’Œåˆ†æ",
  "tools": [                             # å·¥å…·é…ç½®
    {
      "source": "mcp",                   # å·¥å…·æ¥æºï¼šmcp/local_file/python/prebuild
      "mcp_server": "web_search"         # å¯¹åº”çš„ MCP æœåŠ¡å™¨
    },
    {
      "source": "prebuild",              # é¢„æ„å»ºå·¥å…·
      "prebuild_name": "file_manager"    # å·¥å…·åç§°
    }
  ],
  "prompt": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç ”ç©¶åŠ©æ‰‹...",    # Agent ä¸“å±æç¤ºè¯
  "hands_off": ["data_analyst", "writer"] # å¯è½¬äº¤çš„å…¶ä»– Agent
}
```

#### å·¥å…·ç³»ç»Ÿ

æ”¯æŒå¤šç§å·¥å…·æ¥æºï¼š

| å·¥å…·ç±»å‹ | æè¿° | é…ç½®ç¤ºä¾‹ |
|---------|------|----------|
| **MCP** | é€šè¿‡ MCP åè®®è·å–å·¥å…· | `{"source": "mcp", "mcp_server": "web_search"}` |
| **æœ¬åœ°æ–‡ä»¶** | ä» Python æ–‡ä»¶åŠ è½½å‡½æ•° | `{"source": "local_file", "local_file_path": "./tools/custom.py"}` |
| **Python ä»£ç ** | ç›´æ¥æ‰§è¡Œ Python ä»£ç  | `{"source": "python", "python_code": "def my_tool(): ..."}` |
| **é¢„æ„å»º** | ä½¿ç”¨å†…ç½®å·¥å…· | `{"source": "prebuild", "prebuild_name": "calculator"}` |

#### æ‰§è¡Œæµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[Decision Maker]
    B --> C{ä»»åŠ¡è§„åˆ’}
    C -->|ç®€å•å¯¹è¯| D[ç›´æ¥å›ç­”]
    C -->|å¤æ‚ä»»åŠ¡| E[åˆ†é…ç»™ä¸“ä¸š Agent]
    E --> F[Agent æ‰§è¡Œ]
    F -->|éœ€è¦åä½œ| G[è½¬äº¤å…¶ä»– Agent]
    F -->|éœ€è¦ä¿¡æ¯| H[è¯·æ±‚ç”¨æˆ·è¾“å…¥]
    F -->|ä»»åŠ¡å®Œæˆ| I[è¿”å› Decision Maker]
    G --> F
    H --> F
    I --> B
    B --> J[ä»»åŠ¡å®Œæˆ]
```

#### ä½¿ç”¨ç¤ºä¾‹

1. **åˆ›å»º Agent é…ç½®**ï¼š

```python
research_config = AgentConfig(
    name="researcher",
    description="è´Ÿè´£ä¿¡æ¯æ”¶é›†å’Œç ”ç©¶",
    tools=[
        ToolResouce(source="mcp", mcp_server="web_search"),
        ToolResouce(source="prebuild", prebuild_name="file_reader")
    ],
    prompt="ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç ”ç©¶åŠ©æ‰‹ï¼Œæ“…é•¿æ”¶é›†å’Œåˆ†æä¿¡æ¯ã€‚",
    hands_off=["analyst", "writer"]
)
```

2. **å¯åŠ¨å¤šä»£ç†ç³»ç»Ÿ**ï¼š

```python
agent_system = Agent(
    model_name="qwen2.5",
    llm=ChatOpenAI(...),
    agents=[research_config, analyst_config, writer_config],
    mcp_client=mcp_client
)

graph = await agent_system.build()
```

3. **äº¤äº’æ‰§è¡Œ**ï¼š

```python
# ç”¨æˆ·è¾“å…¥ä»»åŠ¡
result = await graph.ainvoke({
    "messages": [HumanMessage(content="å¸®æˆ‘ç ”ç©¶ä¸€ä¸‹ AI çš„æœ€æ–°å‘å±•")],
    "thread_id": "session_001"
})
```

#### ä¸­æ–­ä¸æ¢å¤

æ”¯æŒä»»åŠ¡ä¸­æ–­å’Œæ¢å¤æœºåˆ¶ï¼š

- **ä¸»åŠ¨ä¸­æ–­**ï¼šAgent å¯ä½¿ç”¨ `request_user_input` å·¥å…·è¯·æ±‚æ›´å¤šä¿¡æ¯
- **çŠ¶æ€ä¿å­˜**ï¼šä½¿ç”¨ MemorySaver ä¿å­˜æ‰§è¡ŒçŠ¶æ€
- **æ¢å¤æ‰§è¡Œ**ï¼šç”¨æˆ·æä¾›ä¿¡æ¯åè‡ªåŠ¨æ¢å¤åˆ°ä¸­æ–­ç‚¹

#### æœ€ä½³å®è·µ

1. **èŒè´£åˆ†ç¦»**ï¼šä¸ºä¸åŒä¸“ä¸šé¢†åŸŸåˆ›å»ºä¸“é—¨çš„ Agent
2. **å·¥å…·é…ç½®**ï¼šæ ¹æ® Agent èŒè´£é…ç½®åˆé€‚çš„å·¥å…·é›†
3. **åä½œé“¾è·¯**ï¼šé€šè¿‡ `hands_off` é…ç½®åˆç†çš„ Agent åä½œå…³ç³»
4. **æç¤ºè¯ä¼˜åŒ–**ï¼šä¸ºæ¯ä¸ª Agent ç¼–å†™ä¸“ä¸šåŒ–çš„æç¤ºè¯
5. **é”™è¯¯å¤„ç†**ï¼šåœ¨å·¥å…·è°ƒç”¨ä¸­æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†é€»è¾‘

é€šè¿‡è¿™å¥—å¤šä»£ç†ç³»ç»Ÿï¼Œå¯ä»¥æ„å»ºå‡ºåŠŸèƒ½å¼ºå¤§ã€ä¸“ä¸šåˆ†å·¥çš„ AI åŠ©æ‰‹å›¢é˜Ÿï¼Œæ˜¾è‘—æå‡å¤æ‚ä»»åŠ¡çš„å¤„ç†èƒ½åŠ›å’Œè´¨é‡ã€‚

## å¸¸è§é—®é¢˜

TODO

## å¼€å‘è®¡åˆ’
- [x] Live2D æ¨¡å‹æ”¯æŒ
- [x] å¤šè½®å¯¹è¯æ”¯æŒ
- [x] MCP å·¥å…·é›†æˆ
- [x] å¯æ‹“å±•çš„ multi-agent æ”¯æŒ
- [ ] Streamable mcp æ”¯æŒ
- [ ] æ”¯æŒ TTS è¯­éŸ³åˆæˆ
- [x] æ”¯æŒ Web æœç´¢ (é€šè¿‡searxngå®ç°ï¼Œéœ€è¦åœ¨æœ¬åœ°éƒ¨ç½²searxngæœåŠ¡ï¼Œå¹¶ç›‘å¬127.0.0.1:8080ç«¯å£)
- [ ] æœ¬åœ°çŸ¥è¯†åº“æ”¯æŒ

## License
MIT 